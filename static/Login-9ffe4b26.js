import{u as z,r as w,k as M,d as k,p as T,U,o as y,c as N,q as e,w as l,a as t,b as h,v as S,x as V,z as _,t as m,ag as j,l as A,T as F,W as G,ah as E,ai as H,G as I,aj as W,H as J,ak as K}from"./vendor-b5206b48.js";import{u as O,i as a,L as P,A as Q}from"./index-d1ccb639.js";import{u as X,a as Y}from"./auth-2080eb3e.js";const Z={class:"auth-container"},aa={class:"btns"},ea={class:"bottom"},oa=h("div",{id:"recaptcha",style:{height:"80px"}},null,-1),ra={__name:"Login",setup(ta){const f=O(),C=z(),u=w(!1),n=w(!1),s=M({email:"",password:"",captchaData:""}),x={email:[{required:!0,message:`${a.global.t("user.请输入邮箱")}`,trigger:"change"},{type:"email",message:`${a.global.t("user.邮箱格式错误")}`,trigger:"change"}],password:[{required:!0,message:`${a.global.t("user.请输入密码")}`,trigger:"change"},{min:8,message:`${a.global.t("user.密码至少为8个字符")}`,trigger:"change"}]},L=k(()=>f.globalConfig.is_recaptcha===1),D=k(()=>f.globalConfig.recaptcha_site_key);function $(){n.value=!0,K(()=>{Y(["https://www.google.com/recaptcha/api.js?onload=onloadCallback3&render=explicit"],"google-recaptcha3"),window.onloadCallback3=()=>{const r=window.grecaptcha.render("recaptcha",{sitekey:D.value,callback:()=>{n.value=!1,s.captchaData=window.grecaptcha.getResponse(r),window.grecaptcha.reset(r),v(null,!0)}})}})}async function v(r,o){const{email:p,password:c,captchaData:d}=j(s);if(L.value&&!o){$();return}u.value=!0;try{const{data:g}=await X({email:p,password:c,captchaData:d});A.set(Q,g.auth_data),F.success(`${a.global.t("user.登录成功")}`),C.push("/profile"),location.reload()}catch{}u.value=!1}return(r,o)=>{const p=G,c=E,d=H,g=I,b=T("router-link"),B=W,R=J,q=U("wave");return y(),N("div",Z,[e(B,{class:"auth-form",model:s,rules:x,hideRequiredMark:"",colon:!1,layout:"vertical",onFinish:v},{default:l(()=>[e(c,{class:"control-item",label:t(a).global.t("user.邮箱"),name:"email"},{default:l(()=>[e(p,{value:s.email,"onUpdate:value":o[0]||(o[0]=i=>s.email=i),class:"control-input",size:"large",placeholder:t(a).global.t("user.请输入邮箱"),allowClear:""},null,8,["value","placeholder"])]),_:1},8,["label"]),e(c,{class:"control-item",label:t(a).global.t("user.密码"),name:"password"},{default:l(()=>[e(d,{value:s.password,"onUpdate:value":o[1]||(o[1]=i=>s.password=i),class:"control-input",size:"large",maxlength:64,placeholder:t(a).global.t("user.请输入密码"),allowClear:!1},null,8,["value","placeholder"])]),_:1},8,["label"]),h("div",aa,[S((y(),V(g,{type:"primary",class:"btn",loading:u.value,shape:"round",htmlType:"submit"},{default:l(()=>[_(m(t(a).global.t("user.登录")),1)]),_:1},8,["loading"])),[[q]])]),h("div",ea,[e(b,{class:"link",to:"/register"},{default:l(()=>[_(m(t(a).global.t("user.注册")),1)]),_:1}),e(b,{class:"link",to:"/reset-password"},{default:l(()=>[_(m(t(a).global.t("user.忘记密码")),1)]),_:1})]),e(t(P),{class:"logo"})]),_:1},8,["model"]),e(R,{open:n.value,centered:"",footer:null,onCancel:o[2]||(o[2]=i=>n.value=!1)},{default:l(()=>[oa]),_:1},8,["open"])])}}};export{ra as default};
