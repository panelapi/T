import{u as ue,_ as xe,i as d,P as re,a as Se,b as Oe}from"./index-d1ccb639.js";import{u as Le,g as Te,w as Z,i as y,P as qe,a as Re,m as Ue,v as ze}from"./subscribe-51d6c223.js";import{g as De,a as Ne,b as Ae,c as Be,d as Ee}from"./order-a8d984dd.js";import{u as je,k as Fe,r as b,d as K,m as He,T as oe,U as Je,o as g,c as V,b as c,t as f,q as h,a as Ge,w as m,z as R,F as z,s as H,x as O,n as Q,v as J,A as le,l as ce,W as We,X as Ye,Y as Xe,Z as Ze,$ as Ke,a0 as Qe,a1 as et,a2 as tt,G as at,H as st,I as it,J as nt}from"./vendor-b5206b48.js";function rt(l=16,s=!1){const r="abcdefghijklmnopqrstuvwxyz",a="1234567890",u=[],_=s?a:r,v=_.length;for(;u.length<l;){const w=_[Math.floor(Math.random()*v)];u.push(Math.random()>.5?w:w.toUpperCase())}return u.join("")}/*!
 * currency.js - v2.0.4
 * http://scurker.github.io/currency.js
 *
 * Copyright (c) 2021 Jason Wilson
 * Released under MIT license
 */var ot={symbol:"$",separator:",",decimal:".",errorOnInvalid:!1,precision:2,pattern:"!#",negativePattern:"-!#",format:dt,fromCents:!1},de=function(s){return Math.round(s)},ee=function(s){return Math.pow(10,s)},lt=function(s,r){return de(s/r)*r},ct=/(\d)(?=(\d{3})+\b)/g,ut=/(\d)(?=(\d\d)+\d\b)/g;function M(l,s){var r=this;if(!(r instanceof M))return new M(l,s);var a=Object.assign({},ot,s),u=ee(a.precision),_=G(l,a);r.intValue=_,r.value=_/u,a.increment=a.increment||1/u,a.useVedic?a.groups=ut:a.groups=ct,this.s=a,this.p=u}function G(l,s){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=0,u=s.decimal,_=s.errorOnInvalid,v=s.precision,w=s.fromCents,$=ee(v),k=typeof l=="number",I=l instanceof M;if(I&&w)return l.intValue;if(k||I)a=I?l.value:l;else if(typeof l=="string"){var x=new RegExp("[^-\\d"+u+"]","g"),U=new RegExp("\\"+u,"g");a=l.replace(/\((.*)\)/,"-$1").replace(x,"").replace(U,"."),a=a||0}else{if(_)throw Error("Invalid Input");a=0}return w||(a*=$,a=a.toFixed(4)),r?de(a):a}function dt(l,s){var r=s.pattern,a=s.negativePattern,u=s.symbol,_=s.separator,v=s.decimal,w=s.groups,$=(""+l).replace(/^-/,"").split("."),k=$[0],I=$[1];return(l.value>=0?r:a).replace("!",u).replace("#",k.replace(w,"$1"+_)+(I?v+I:""))}M.prototype={add:function(s){var r=this.intValue,a=this.s,u=this.p;return M((r+=G(s,a))/(a.fromCents?1:u),a)},subtract:function(s){var r=this.intValue,a=this.s,u=this.p;return M((r-=G(s,a))/(a.fromCents?1:u),a)},multiply:function(s){var r=this.intValue,a=this.s;return M((r*=s)/(a.fromCents?1:ee(a.precision)),a)},divide:function(s){var r=this.intValue,a=this.s;return M(r/=G(s,a,!1),a)},distribute:function(s){for(var r=this.intValue,a=this.p,u=this.s,_=[],v=Math[r>=0?"floor":"ceil"](r/s),w=Math.abs(r-v*s),$=u.fromCents?1:a;s!==0;s--){var k=M(v/$,u);w-- >0&&(k=k[r>=0?"add":"subtract"](1/$)),_.push(k)}return _},dollars:function(){return~~this.value},cents:function(){var s=this.intValue,r=this.p;return~~(s%r)},format:function(s){var r=this.s;return typeof s=="function"?s(this,r):r.format(this,Object.assign({},r,s))},toString:function(){var s=this.intValue,r=this.p,a=this.s;return lt(s/r,a.increment).toFixed(a.precision)},toJSON:function(){return this.value}};function L(l=0){var a;const r=((a=ue().userConfig)==null?void 0:a.currency_symbol)??"¥";return M(l,{fromCents:!0,symbol:r}).format()}const pe=l=>(it("data-v-e4bae215"),l=l(),nt(),l),pt={key:0,class:"plan-container"},_t={class:"title-bar"},ft={class:"form-container"},vt={class:"form-item"},mt={class:"form-label"},ht={class:"form-content"},gt={class:"title-tip"},yt={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},bt={class:"title-bar"},wt={class:"rbtn"},$t={class:"plan-cards"},kt=["onClick"],Ct={class:"tit"},Pt={class:"subtit"},It=["innerHTML"],Vt={class:"desc"},Mt={key:1,class:"plan-slide"},xt={style:{width:"150px"}},St=pe(()=>c("div",{style:{width:"100%","text-align":"center","font-size":"18px",color:"#272933"}}," 暂无套餐 ",-1)),Ot={key:0},Lt={class:"title-bar",style:{"margin-top":"40px"}},Tt={class:"packages"},qt=["onClick"],Rt={class:"tit"},Ut=pe(()=>c("div",{class:"title-bar",style:{"margin-top":"40px"}},"3.支付方式",-1)),zt={class:"payment-cards"},Dt=["onClick"],Nt=["src"],At={class:"tit"},Bt={class:"form-item",style:{"margin-top":"40px"}},Et={class:"form-label"},jt={class:"form-content"},Ft={class:"title-tip coupon-info"},Ht={key:0,class:"plan-buttons"},Jt={class:"pay-modal"},Gt={class:"pm-icon"},Wt={class:"pm-tip"},P="|",Yt={__name:"Plan",setup(l){const s=!(window.screen.width>=768),r=ue(),a=je(),u=Fe({planId:"",paymentId:""}),_=b(""),v=b([]),w=b([]),$=b(!1);b(!1);const k=b(""),I=b(1),x=b(0),U=b(!1);let D=0;const q=b("");b(!1);let te=b(0);const N=b([]);b(!1);const ae=b("true");Le(1);const T=K(()=>v.value.find(n=>n.id===u.planId)),_e=K(()=>{var o;const e=(o=T.value)==null?void 0:o.comboList.find((t,C)=>{if(q.value===t.value)return t.value}),n=(e==null?void 0:e.price)||0,i=I.value===1?n-x.value:n*(1-x.value/100);return L(i>0?i:0)}),fe=K(()=>{var i;const e=(i=T.value)==null?void 0:i.comboList.find(o=>{var t;return o.value===((t=T.value)==null?void 0:t.comboValue)}),n=I.value===1?x.value:((e==null?void 0:e.price)||0)*(x.value/100);return L(n||0)});async function W(e=!1){const n=[],i=[];if(e==!0)for(let o=0;o<v.value.length;o++)v.value[o].isOnetime===e&&i.push(v.value[o]);else for(let o=0;o<v.value.length;o++)v.value[o].comboList.length>1&&v.value[o].isCycle===!0&&i.push(v.value[o]);if(s)for(let o=0;o<i.length;o++){const t=[];i[o]&&t.push(i[o]),n.push(t)}else for(let o=0;o<i.length;o+=2){const t=[];i[o]&&t.push(i[o]),i[o+1]&&t.push(i[o+1]),n.push(t)}return N.value=n,u.planId=n[0][0].id,q.value=n[0][0].comboList[0].value,n}He(async()=>{U.value=!1,await ve(),await we(),await be(),await me(),await W(),U.value=!0});async function ve(){const e=await Te(),n=e.data.u+e.data.d,i=e.data.transfer_enable;te.value=n/i*100}async function me(){const i=((await Z(Re)).data??[]).filter(t=>!y(t.name));function o(t){const C=[];return t&&(t.month_price&&C.push({value:t.id+P+"month_price",label:d.global.t("plan.月付"),price:t.month_price,perMonth:t.month_price}),t.quarter_price&&C.push({value:t.id+P+"quarter_price",label:d.global.t("plan.季付"),price:t.quarter_price,perMonth:t.quarter_price/3}),t.half_year_price&&C.push({value:t.id+P+"half_year_price",label:d.global.t("plan.半年"),price:t.half_year_price,perMonth:t.half_year_price/6}),t.year_price&&C.push({value:t.id+P+"year_price",label:d.global.t("plan.年付"),price:t.year_price,perMonth:t.year_price/12}),t.two_year_price&&C.push({value:t.id+P+"two_year_price",label:d.global.t("plan.两年"),price:t.two_year_price,perMonth:t.two_year_price/24}),t.three_year_price&&C.push({value:t.id+P+"three_year_price",label:d.global.t("plan.三年"),price:t.three_year_price,perMonth:t.three_year_price/36}),t.onetime_price&&C.push({value:t.id+P+"onetime_price",label:d.global.t("plan.一次性"),price:t.onetime_price,perMonth:t.onetime_price}),t.reset_price&&te.value>=80&&C.push({value:t.id+P+"reset_price",label:d.global.t("plan.重置包"),price:t.reset_price,perMonth:t.reset_price})),C}v.value=i.map(t=>({id:rt(12),title:t.name,subTitle:(t.transfer_enable>1e4?d.global.t("plan.无限流量"):t.transfer_enable+d.global.t("plan.GB流量"))+". "+d.global.t("plan.全球节点"),comboValue:t.id+P+he(t),isOnetime:!y(t.onetime_price),isCycle:!y(t.month_price)||!y(t.quarter_price)||!y(t.half_year_price)||!y(t.year_price)||!y(t.two_year_price)||!y(t.three_year_price),comboList:o(t)})),se(v.value[0])}function he(e){if(!y(e.month_price))return"month_price";if(!y(e.quarter_price))return"quarter_price";if(!y(e.half_year_price))return"half_year_price";if(!y(e.year_price))return"year_price";if(!y(e.two_year_price))return"two_year_price";if(!y(e.three_year_price))return"three_year_price";if(!y(e.onetime_price))return"onetime_price";if(!y(e.reset_price))return"reset_price"}function ge(e){let n="20%";e.isOnetime||(n=parseInt((1-e.comboList[2].price/(e.comboList[0].price*12))*100)+"%");const i=e.comboList.find(o=>o.value===e.comboValue);return e.isOnetime&&e.isCycle==!1?(e.desc=`${d.global.t("plan.流量永久有效")}`,L(i.price)):e.isOnetime&&e.isCycle?i.value.toString().includes("onetime_price")?(e.desc=`${d.global.t("plan.流量永久有效")}`,L(i.price)):(e.desc=`${d.global.t("plan.按年付费可节省")}${n}${d.global.t("plan.费用")}`,i.value.toString().includes("reset_price")?L(i.perMonth)+`<small>/${d.global.t("plan.重置包")}</small>`:L(i.perMonth)+`<small>/${d.global.t("plan.月")}</small>`):(e.desc=`${d.global.t("plan.按年付费可节省")}${n}${d.global.t("plan.费用")}`,i.value.toString().includes("reset_price")?L(i.perMonth)+`<small>/${d.global.t("plan.重置包")}</small>`:L(i.perMonth)+`<small>/${d.global.t("plan.月")}</small>`)}function se(e){u.planId=e.id,x.value=0,k.value="",q.value=e.comboValue}function ie(e){u.paymentId=e.id,ce.set(re,e.id)}function ye(e){q.value=e.value;let n=v.value.find(i=>i.id===u.planId);n.comboValue=e.value}async function be(){const n=((await Z(Ne)).data??[]).find(i=>i.status===qe.WAIT_PAY);n&&(_.value=n.trade_no,$.value=!0,Y())}async function we(){const e=await Z(Ae);w.value=e.data??[],w.value.length>0&&ie(w.value[0])}async function $e(){const e=T.value.comboValue.split(P),n=e[0],i=e[1],o=await Ue({plan_id:n,period:i,coupon_code:k.value||""});o.data&&(_.value=o.data,$.value=!0,Y())}function Y(){D=setTimeout(()=>{_.value&&De(_.value).then(e=>{Number(e.data)===3?(clearTimeout(D),oe.success("购买成功"),$.value=!1,a.replace("/profile?refresh=1")):Y()})},3e3)}async function ke(){const e=await Be(_.value,ce.get(re)||u.paymentId);if(console.log("res===>",e),e.type===1){const n=e.data;window.location.href=n}else e.type===0?(clearTimeout(D),a.push({path:"/payqr",query:{img:encodeURIComponent(e.data),orderId:_.value}})):e.type}async function Ce(){(await Ee(_.value)).data===!0&&(clearTimeout(D),oe.success("已取消"),$.value=!1,_.value="")}async function Pe(){try{if(!k.value)return this.$notification.error({message:`${d.global.t("plan.提示")}`,description:`${d.global.t("plan.请输入优惠券")}`});const n=T.value.comboValue.split(P)[0],i=await ze({code:k.value,plan_id:n});I.value=i.data.type||1,i.data.value&&(i.data.limit_plan_ids===null||i.data.limit_plan_ids.includes(String(n)))?x.value=i.data.value:(x.value=0,this.$notification.error({message:"提示",description:"无效的优惠券"}))}catch{}}return(e,n)=>{const i=We,o=Ye,t=Xe,C=Ze,A=Se,B=Ke,E=Qe,Ie=et,ne=tt,j=at,Ve=Oe,Me=st,F=Je("wave");return g(),V(z,null,[U.value?(g(),V("div",pt,[c("div",_t,f(e.$t("plan.确认充值账户")),1),c("div",ft,[c("div",vt,[c("div",mt,f(e.$t("plan.邮箱")),1),c("div",ht,[h(i,{value:Ge(r).userInfo.email.toUpperCase(),class:"form-input",maxlength:64,readonly:"",placeholder:"请输入邮箱"},null,8,["value"])])]),c("div",gt,f(e.$t("plan.title_tip")),1)]),h(o),c("div",yt,[c("div",bt,f(e.$t("plan.选择适合方案")),1),c("div",wt,[h(C,{value:ae.value,"onUpdate:value":n[2]||(n[2]=p=>ae.value=p)},{default:m(()=>[h(t,{value:"true",onClick:n[0]||(n[0]=p=>W(!1))},{default:m(()=>[R(f(e.$t("plan.周期")),1)]),_:1}),h(t,{value:"false",onClick:n[1]||(n[1]=p=>W(!0))},{default:m(()=>[R(f(e.$t("plan.按量")),1)]),_:1})]),_:1},8,["value"])])]),c("div",$t,[h(Ie,{arrows:"",dots:!1,infinite:!1},{prevArrow:m(()=>[h(A,{name:"caret-left",size:"50px",color:"#000"})]),nextArrow:m(()=>[h(A,{name:"caret-right",size:"50px",color:"#000"})]),default:m(()=>[N.value.length>0?(g(!0),V(z,{key:0},H(N.value,(p,X)=>(g(),V("div",{key:X,class:"plan-slide"},[h(E,{gutter:[25,25]},{default:m(()=>[(g(!0),V(z,null,H(p,S=>(g(),O(B,{key:S.id,md:12,xs:24},{default:m(()=>[c("div",{class:Q(["plan-card",{"is-active":S.id===u.planId,"is-period":!S.isOnetime}]),onClick:Xt=>se(S)},[c("div",Ct,f(S.title),1),c("div",Pt,f(S.subTitle),1),c("div",{class:"price",innerHTML:ge(S)},null,8,It),c("div",Vt,f(S.desc),1)],10,kt)]),_:2},1024))),128))]),_:2},1024)]))),128)):(g(),V("div",Mt,[h(E,{gutter:[25,25]},{default:m(()=>[h(B,{md:12,xs:24},{default:m(()=>[c("div",xt,[h(A,{name:"smiley-x-eyes",size:"150px",color:"#ccc",style:{"text-align":"center",color:"#272933"},weight:"fill"}),St])]),_:1})]),_:1})]))]),_:1}),N.value.length>0?(g(),V("div",Ot,[c("div",Lt,"   "+f(e.$t("plan.选择套餐")),1),c("div",Tt,[h(E,{gutter:[25,25]},{default:m(()=>[(g(!0),V(z,null,H(T.value.comboList,p=>(g(),O(B,{key:p.value,md:8,xs:24},{default:m(()=>[c("div",{class:Q(["package-item",{"is-active":p.value===q.value}]),onClick:X=>ye(p)},[c("div",Rt,f(p.label),1),h(ne,{class:"check",checked:p.value===q.value},null,8,["checked"])],10,qt)]),_:2},1024))),128))]),_:1})]),Ut,c("div",zt,[h(E,{gutter:[25,25]},{default:m(()=>[(g(!0),V(z,null,H(w.value,p=>(g(),O(B,{key:p.id,md:12,xs:24},{default:m(()=>[c("div",{class:Q(["payment-card",{"is-active":p.id===u.paymentId}]),onClick:X=>ie(p)},[c("img",{class:"icon",src:p.icon},null,8,Nt),c("div",At,f(p.name),1),h(ne,{class:"check",checked:p.id===u.paymentId},null,8,["checked"])],10,Dt)]),_:2},1024))),128))]),_:1})]),c("div",Bt,[c("div",Et,f(e.$t("plan.抵扣金额")),1),c("div",jt,[h(i,{value:k.value,"onUpdate:value":n[3]||(n[3]=p=>k.value=p),class:"form-input control-input",maxlength:64,placeholder:e.$t("plan.有优惠劵")},{suffix:m(()=>[J((g(),O(j,{type:"primary",size:"small",shape:"round",onClick:Pe},{default:m(()=>[R(f(e.$t("plan.验证")),1)]),_:1})),[[F]])]),_:1},8,["value","placeholder"])])]),c("div",Ft,f(e.$t("plan.折扣金额"))+" -"+f(fe.value),1),T.value?(g(),V("div",Ht,[J((g(),O(j,{type:"primary",shape:"round",onClick:$e},{default:m(()=>[R(f(_e.value)+" "+f(e.$t("plan.立即购买")),1)]),_:1})),[[F]])])):le("",!0)])):le("",!0)])])):(g(),O(Ve,{key:1})),h(Me,{open:$.value,"onUpdate:open":n[4]||(n[4]=p=>$.value=p),footer:null,centered:"",width:"380px",maskClosable:!1,closable:!1},{default:m(()=>[c("div",Jt,[c("div",Gt,[h(A,{name:"warning-circle",weight:"fill"})]),c("div",Wt,f(e.$t("plan.paymentTips")),1),J((g(),O(j,{type:"primary",class:"pm-btn",onClick:ke},{default:m(()=>[R(f(e.$t("plan.点击支付")),1)]),_:1})),[[F]]),J((g(),O(j,{type:"primary",class:"pm-btn",ghost:"",onClick:Ce},{default:m(()=>[R(f(e.$t("plan.取消")),1)]),_:1})),[[F]])])]),_:1},8,["open"])],64)}}},ta=xe(Yt,[["__scopeId","data-v-e4bae215"]]);export{ta as default};
