import{u as G,r as u,k as O,d as b,m as H,l as p,af as z,p as W,U as A,o as w,c as J,q as s,w as o,a as r,v as D,x as $,z as h,t as y,b as k,ag as q,T as B,W as K,ah as Q,G as X,aj as Y,H as Z,ak as ee}from"./vendor-b5206b48.js";import{u as ae,i as a,L as le}from"./index-d1ccb639.js";import{s as te,r as se,a as oe}from"./auth-2080eb3e.js";const re={class:"auth-container"},ne={class:"btns"},ie={class:"bottom",style:{"justify-content":"center"}},ce=k("div",{id:"recaptcha",style:{height:"80px"}},null,-1),g="FindTime",ge={__name:"ResetPassword",setup(ue){const C=ae(),M=G(),v=u(null),f=u(!1),_=u(!1),d=u(!1),c=u(0),t=O({email:"",emailCode:"",password:"",captchaData:""}),U=b(()=>L()),j=b(()=>C.globalConfig.is_recaptcha===1),I=b(()=>C.globalConfig.recaptcha_site_key);H(()=>{const l=p.get(g);if(l){const e=60-(z().valueOf()-l)/1e3;e>0?x(e):p.remove(g)}});function L(){return{email:[{required:!0,message:a.global.t("user.请输入邮箱"),trigger:"blur"},{type:"email",message:a.global.t("user.邮箱格式错误"),trigger:"blur"}],password:[{required:!0,message:a.global.t("user.请输入密码"),trigger:"blur"},{min:8,message:a.global.t("user.密码至少为8个字符"),trigger:"blur"}],emailCode:[{required:!0,message:a.global.t("user.请输入验证码"),trigger:"blur"}]}}function x(l){c.value=l;const e=setInterval(()=>{c.value--,c.value<=0&&(clearInterval(e),p.remove(g))},1e3)}function S(){d.value=!0,ee(()=>{oe(["https://www.google.com/recaptcha/api.js?onload=onloadCallback2&render=explicit"],"google-recaptcha2"),window.onloadCallback2=()=>{const l=window.grecaptcha.render("recaptcha",{sitekey:I.value,callback:()=>{d.value=!1,t.captchaData=window.grecaptcha.getResponse(l),window.grecaptcha.reset(l),R(null,!0)}})}})}async function R(l,e){const{email:n}=q(t);if(await v.value.validate(["email"]),j.value&&!e){S();return}_.value=!0;try{(await te({email:n,recaptcha_data:t.captchaData})).data===!0&&(B.success(a.global.t("user.验证码发送成功")),p.set(g,z().valueOf()),x(60))}catch{}_.value=!1}async function E(){const{email:l,password:e,emailCode:n}=q(t);await v.value.validate(),f.value=!0;try{await se({email:l,password:e,email_code:n}),B.success(a.global.t("user.密码重置成功")),M.push("/login")}catch{}f.value=!1}return(l,e)=>{const n=K,m=Q,F=X,N=W("router-link"),P=Y,V=Z,T=A("wave");return w(),J("div",re,[s(P,{ref_key:"refForm",ref:v,class:"auth-form",model:t,rules:U.value,hideRequiredMark:"",colon:!1,layout:"vertical",onFinish:E},{default:o(()=>[s(m,{class:"control-item",label:r(a).global.t("user.邮箱"),name:"email"},{default:o(()=>[s(n,{value:t.email,"onUpdate:value":e[0]||(e[0]=i=>t.email=i),class:"control-input",size:"large",placeholder:r(a).global.t("user.请输入邮箱"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),s(m,{class:"control-item",label:r(a).global.t("user.验证码"),name:"emailCode"},{default:o(()=>[s(n,{value:t.emailCode,"onUpdate:value":e[2]||(e[2]=i=>t.emailCode=i),class:"control-input",size:"large",maxlength:32,placeholder:r(a).global.t("user.请输入验证码")},{suffix:o(()=>[D((w(),$(F,{type:"primary",loading:_.value,disabled:c.value>0,class:"btn-vcode",shape:"round",size:"small",onClick:e[1]||(e[1]=i=>R())},{default:o(()=>[h(y(c.value>0?`${parseInt(c.value)}s`:`${r(a).global.t("user.发送")}`),1)]),_:1},8,["loading","disabled"])),[[T]])]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(m,{class:"control-item",label:r(a).global.t("user.请输入验证码"),name:"password"},{default:o(()=>[s(n,{value:t.password,"onUpdate:value":e[3]||(e[3]=i=>t.password=i),class:"control-input",type:"password",size:"large",maxlength:64,placeholder:r(a).global.t("user.请输入密码"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),k("div",ne,[D((w(),$(F,{type:"primary",class:"btn",loading:f.value,size:"large",htmlType:"submit"},{default:o(()=>[h(y(l.$t("user.重置密码")),1)]),_:1},8,["loading"])),[[T]])]),k("div",ie,[s(N,{class:"link",to:"/login"},{default:o(()=>[h(y(l.$t("user.登录")),1)]),_:1})]),s(r(le),{class:"logo"})]),_:1},8,["model","rules"]),s(V,{open:d.value,centered:"",footer:null,onCancel:e[4]||(e[4]=i=>d.value=!1)},{default:o(()=>[ce]),_:1},8,["open"])])}}};export{ge as default};
