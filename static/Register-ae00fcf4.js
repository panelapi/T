import{u as oe,j as se,r as d,k as re,d as p,m as ne,l as k,af as N,p as ie,U as ue,o as u,c as O,q as r,w as s,a as n,al as ce,x as v,F as de,s as pe,z as b,t as w,A as q,v as G,b as j,ag as $,T as H,am as me,a7 as ge,W as ve,ah as fe,G as _e,aj as be,H as we,I as he,J as ye,ak as Ce}from"./vendor-b5206b48.js";import{_ as ke,u as xe,i as t,L as Re}from"./index-d1ccb639.js";import{s as Se,b as Ie,a as qe}from"./auth-2080eb3e.js";const $e=h=>(he("data-v-c8e60f5a"),h=h(),ye(),h),je={class:"auth-container register"},ze={class:"btns"},Ue={class:"bottom"},Ae=$e(()=>j("div",{id:"recaptcha",style:{height:"80px"}},null,-1)),x="RegTime",De={__name:"Register",setup(h){const f=xe(),J=oe(),z=se(),U=d(null),R=d(!1),S=d(!1),y=d(!1),C=d(""),m=d(0);d([]);const l=re({email:"",emailAddon:"",password:"",password2:"",emailCode:"",inviteCode:"",captchaData:""}),W=(a,e,g)=>e===""?Promise.reject(t.global.t("user.请输入确认密码")):e!==l.password?Promise.reject(t.global.t("user.两次输入的密码不一致")):Promise.resolve(),K=(a,e,g)=>e===""?Promise.reject(t.global.t("user.请输入邮箱")):l.email.includes("@")?Promise.reject(t.global.t("user.邮箱格式错误")):Promise.resolve(),Q=p(()=>ee()),_=p(()=>ae()),A=p(()=>f.globalConfig.is_email_verify===1),X=p(()=>f.globalConfig.is_invite_force===1),Y=p(()=>X||z.query.code),D=p(()=>f.globalConfig.is_recaptcha===1),Z=p(()=>f.globalConfig.recaptcha_site_key);ne(()=>{l.inviteCode=z.query.code??"";const a=k.get(x);if(a){const e=60-(N().valueOf()-a)/1e3;e>0?T(e):k.remove(x)}});function ee(){const a={email:[],password:[{required:!0,message:t.global.t("user.请输入密码"),trigger:"blur"},{min:8,message:t.global.t("user.密码至少为8个字符"),trigger:"blur"}],password2:[{required:!0,validator:W,trigger:"change"}],emailCode:[{required:!0,message:t.global.t("user.请输入验证码"),trigger:"blur"}]};return _.value.length>0?a.email.push({required:!0,validator:K,trigger:"blur"}):a.email.push({required:!0,type:"email",message:t.global.t("user.邮箱格式错误"),trigger:"blur"}),a}function ae(){const a=(f.globalConfig.email_whitelist_suffix||[]).map(e=>"@"+e);return a.length>0&&(l.emailAddon=a[0]),a}function E(){const{email:a,emailAddon:e}=$(l);return _.value.length>0?a+e:a}function T(a){m.value=a;const e=setInterval(()=>{m.value--,m.value<=0&&(clearInterval(e),k.remove(x))},1e3)}function V(){y.value=!0,Ce(()=>{qe(["https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit"],"google-recaptcha"),window.onloadCallback=()=>{const a=window.grecaptcha.render("recaptcha",{sitekey:Z.value,callback:()=>{y.value=!1,l.captchaData=window.grecaptcha.getResponse(a),window.grecaptcha.reset(a),C.value==="register"?P(!0):F(!0)}})}})}async function F(a){if($(l),await U.value.validate(["email"]),D.value&&!a){C.value="sendEmail",V();return}S.value=!0;try{(await Se({email:E(),recaptcha_data:l.captchaData})).data===!0&&(H.success(t.global.t("user.验证码发送成功，如未收到请检查垃圾邮件")),k.set(x,N().valueOf()),T(60))}catch{}S.value=!1}async function P(a){const{password:e,password2:g,inviteCode:I,emailCode:i,email:c}=$(l);if(!e||!g||e!==g||A.value&&!i||!c)return!1;if(D.value&&!a&&C.value!=="sendEmail"){C.value="register",V();return}R.value=!0;try{await Ie({email:E(),password:e,invite_code:I,email_code:i,recaptcha_data:l.captchaData}),H.success(t.global.t("user.注册成功")),J.push("/login")}catch{}R.value=!1}return(a,e)=>{const g=me,I=ge,i=ve,c=fe,B=_e,L=ie("router-link"),le=be,te=we,M=ue("wave");return u(),O("div",je,[r(le,{ref_key:"refForm",ref:U,class:"auth-form",model:l,rules:Q.value,hideRequiredMark:"",colon:!1,layout:"vertical",onSubmit:e[7]||(e[7]=o=>P())},{default:s(()=>[r(c,{class:"control-item",label:n(t).global.t("user.邮箱"),name:"email"},{default:s(()=>[r(i,{value:l.email,"onUpdate:value":e[1]||(e[1]=o=>l.email=o),class:"control-input",size:"large",placeholder:n(t).global.t("user.请输入邮箱"),"allow-clear":""},ce({_:2},[_.value.length>0?{name:"addonAfter",fn:s(()=>[_.value.length>0?(u(),v(I,{key:0,value:l.emailAddon,"onUpdate:value":e[0]||(e[0]=o=>l.emailAddon=o),style:{width:"150px"}},{default:s(()=>[(u(!0),O(de,null,pe(_.value,o=>(u(),v(g,{key:o,value:o},{default:s(()=>[b(w(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):q("",!0)]),key:"0"}:void 0]),1032,["value","placeholder"])]),_:1},8,["label"]),A.value?(u(),v(c,{key:0,class:"control-item",label:n(t).global.t("user.验证码"),name:"emailCode"},{default:s(()=>[r(i,{value:l.emailCode,"onUpdate:value":e[3]||(e[3]=o=>l.emailCode=o),class:"control-input",type:"text",size:"large",maxlength:32,placeholder:n(t).global.t("user.请输入验证码"),"allow-clear":""},{suffix:s(()=>[G((u(),v(B,{type:"primary",loading:S.value,disabled:m.value>0,size:"small",shape:"round",class:"btn-vcode",onClick:e[2]||(e[2]=o=>F())},{default:s(()=>[b(w(m.value>0?`${parseInt(m.value)}s`:`${n(t).global.t("user.发送")}`),1)]),_:1},8,["loading","disabled"])),[[M]])]),_:1},8,["value","placeholder"])]),_:1},8,["label"])):q("",!0),r(c,{class:"control-item",label:n(t).global.t("user.密码"),name:"password"},{default:s(()=>[r(i,{value:l.password,"onUpdate:value":e[4]||(e[4]=o=>l.password=o),class:"control-input",type:"password",size:"large",maxlength:64,placeholder:n(t).global.t("user.请输入密码"),autocomplete:"new-password","allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),r(c,{class:"control-item",label:n(t).global.t("user.确认密码"),name:"password2"},{default:s(()=>[r(i,{value:l.password2,"onUpdate:value":e[5]||(e[5]=o=>l.password2=o),class:"control-input",type:"password",size:"large",maxlength:64,placeholder:n(t).global.t("user.请确认密码"),autocomplete:"new-password","allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),Y.value?(u(),v(c,{key:1,class:"control-item",label:n(t).global.t("user.邀请码"),name:"inviteCode"},{default:s(()=>[r(i,{value:l.inviteCode,"onUpdate:value":e[6]||(e[6]=o=>l.inviteCode=o),class:"control-input",type:"text",size:"large",maxlength:64,placeholder:n(t).global.t("user.请输入邀请码"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"])):q("",!0),j("div",ze,[G((u(),v(B,{type:"primary",class:"btn",loading:R.value,size:"large",htmlType:"submit"},{default:s(()=>[b(w(a.$t("user.注册")),1)]),_:1},8,["loading"])),[[M]])]),j("div",Ue,[r(L,{class:"link",to:"/login"},{default:s(()=>[b(w(a.$t("user.登录")),1)]),_:1}),r(L,{class:"link",to:"/reset-password"},{default:s(()=>[b(w(a.$t("user.忘记密码")),1)]),_:1})]),r(n(Re),{class:"logo"})]),_:1},8,["model","rules"]),r(te,{open:y.value,centered:"",footer:null,onCancel:e[8]||(e[8]=o=>y.value=!1)},{default:s(()=>[Ae]),_:1},8,["open"])])}}},Fe=ke(De,[["__scopeId","data-v-c8e60f5a"]]);export{Fe as default};
